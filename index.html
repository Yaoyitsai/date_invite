<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Erin 的像素旅程</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
      background: #000;
    }
    #textBox {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 20px;
      display: none;
      background-color: rgba(0, 0, 0, 0.5);
    }
    #endScene {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('https://i.imgur.com/JmG4Ymj.png') no-repeat center center;
      background-size: cover;
      color: white;
      text-align: center;
      font-size: 24px;
      padding-top: 40vh;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="textBox">Erin 抵達竹南！準備搭飛機前往沖繩 ✈️</div>
<div id="endScene">美樂蒂：我好開心你願意來💗<br><br>你願意陪我一起，飛得更遠嗎？</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const erin = new Image();
erin.src = 'https://i.imgur.com/DmW84ZG.png'; // 像素風 Erin 角色

const map = new Image();
map.src = 'https://i.imgur.com/d9g0zlt.jpeg'; // 高雄到竹南地圖

const airplane = new Image();
airplane.src = 'https://i.imgur.com/UffHiH1.png'; // 飛機像素圖

let erinX = 50, erinY = 450;
const speed = 5;
let destination = { x: 580, y: 310 };
let keys = {};
let flying = false;
let planeX = 600, planeY = 310;

const textBox = document.getElementById('textBox');
const endScene = document.getElementById('endScene');

addEventListener('keydown', e => keys[e.key] = true);
addEventListener('keyup', e => keys[e.key] = false);

function update() {
  if (!flying) {
    if (keys['ArrowUp']) erinY -= speed;
    if (keys['ArrowDown']) erinY += speed;
    if (keys['ArrowLeft']) erinX -= speed;
    if (keys['ArrowRight']) erinX += speed;

    if (Math.abs(erinX - destination.x) < 30 && Math.abs(erinY - destination.y) < 30) {
      flying = true;
      textBox.style.display = 'block';
      setTimeout(() => textBox.style.display = 'none', 2000);
      setTimeout(() => fadeToEnd(), 4000);
    }
  } else {
    planeY -= 2;
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(map, 0, 0, canvas.width, canvas.height);

  if (!flying) {
    ctx.drawImage(erin, erinX, erinY, 64, 64);
  } else {
    ctx.drawImage(airplane, planeX, planeY, 64, 64);
  }
}

function fadeToEnd() {
  canvas.style.display = 'none';
  endScene.style.display = 'block';
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

map.onload = () => gameLoop();
</script>
</body>
</html>
